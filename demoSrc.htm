<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>FX Table Filter Demo</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script type="text/javascript" src="jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="TableFilter.js"></script>
	<script type="text/javascript" src="jQueryPlugin.js"></script>
    <script type="text/javascript">
    
    
        $(document).ready(function () {
            //  Randomly Create Data Rows
            var table1 = $('#demotable1 tbody')
            var trs = '';
           for (var i = 0; i < 50; i++) {
                trs += "<tr><td>Value";
				trs += (Math.floor(Math.random() * 500));
				trs += '</td><td>';
				trs += (Math.floor(Math.random() * 500));
				trs += '</td><td>';
				trs += (Math.random() > 0.5 ? "yes" : "no");
				trs += '</td><td>'
				trs += (Math.random() <= 0.333 ? "Item 1" : Math.random() > 0.5 ? "Item 2" : "Item 3");
				trs += '</td><td></td><td>';
				trs += parseInt(10 + Math.random() * 18);
				trs += "/";
				trs += parseInt(10 + Math.random() * 2);
				trs += '/2009</td><td></td></tr>\n';
            }
            table1.append(trs);

			var table2 = $('#demotable2 tbody');
			var trs2 = '';
            for (var i = 0; i < 50; i++) {
                trs2 = trs2 + "<tr><td>Value(2) " + Math.floor(Math.random() * 500) + "</td></tr>";
            }
            table2.append(trs2);
            
			var se = new picnet.ui.filter.SearchEngine();
			var tooltip = 'Quotes (\") match phrases. (not) excludes a match from the results. (or) can be used to do Or searches. I.e. [red or blue] will match either red or blue. Numeric values support >=, >, <=, <, = and != operators.';
            // Initialise Plugin
            var options1 = {
            	columnFilters: [ 	
            				{ columnName: 'col1', inputType: 'text', toolTipMessage: tooltip, defaultText: 'Type to filter', defaultTextColor: 'red', normalTextColor: 'blue'},
            			 	{ columnName: 'col2', inputType: 'text', toolTipMessage: tooltip, defaultText: 'Type to filter'},
            				{ columnName: 'col3', inputType: 'text'},
            				{ columnName: 'col4', inputType: 'ddl', selectOptionLabel: 'Select...'},
            				{ columnName: 'col5', inputType: 'empty'},
                    { columnName: 'col6', inputType: 'text'},         	
            				{ columnName: 'col7', inputType: 'empty'}
            			],
            	additionalFilters: [{ control: $('#onlyyes'), inputType: 'custom',
            																matchFunction: function(ctrl, trf, textFilterValue, normalisedTokens) 
            																{
            																	return textFilterValue == 'false' || trf.col3 == 'yes';
            																},
            																setupTrigger: function(func)
            																{
            																	$('#onlyyes').click(func);
            																},
            																getValue: function()
            																{
            																	return $('#onlyyes')[0].checked;
            																},
            																setValue: function(value)
            																{
            																	if (!value) $('#onlyyes')[0].checked = false;
            																}
            								},
            						{ control: $('#onlyno'), inputType: 'custom',
            																matchFunction: function(ctrl, trf, textFilterValue, normalisedTokens) 
            																{
            																	return textFilterValue == 'false' || trf.col3 == 'no';
            																},
            																setupTrigger: function(func)
            																{
            																	$('#onlyno').click(func);
            																},
            																getValue: function()
            																{
            																	return $('#onlyno')[0].checked;
            																},
            																setValue: function(value)
            																{
            																	if (!value) $('#onlyno')[0].checked = false;
            																	$('#onlyno')[0].checked = value;
            																}
            								},
            						{ control: $('#quickfind'), inputType: 'text', defaultText: 'Type to filter on all columns', defaultTextColor: 'red', normalTextColor: 'blue'},
            						{ control: $('#quickfind2'), inputType: 'custom',
            																matchFunction: function(ctrl, trf, textFilterValue, normalisedTokens) 
            																{
            																	var textToMatch = trf.col1 + '\t' + trf.col2; 
            																	normalisedTokens = se.parseSearchTokens(textFilterValue);
            																    return se.doesTextMatchTokens(textToMatch, normalisedTokens, false);
            																},
            																setupTrigger: function(func)
            																{
            																	$('#quickfind2').keyup(func);
            																},
            																getValue: function()
            																{
            																	return $('#quickfind2').val();
            																},
            																setValue: function(value)
            																{
            																	if (!value) $('#quickfind2').val('');
            																	$('#quickfind2').val(value);
            																}
            						 
            						   }
            						],
                clearFilterControls: [$('#cleanfilters')],
            };

            $('#demotable1').tableFilter(options1);

            var grid2 = $('#demotable2');
            var options2 = {
            	columnFilters: [ 	
            				{ columnName: 'col1', displayName: 'Text Column 2', inputType: 'text', toolTipMessage: tooltip}
            				],
                filteringRows: function (filterStates) {
                    grid2.addClass('filtering');
                },
                filteredRows: function (filterStates, stats) {
                    grid2.removeClass('filtering');
                    setRowCountOnGrid2(stats);
                }
           };
           
           function setRowCountOnGrid2(stats) {
                $('#rowcount').text('(Rows ' + stats.numberOfRowsVisible + ')');
           }
 			$('#rowcount').text('(Rows ' + (grid2[0].rows.length-1) + ')');
           grid2.tableFilter(options2);			
        });
  </script>
</head>
<body>  
<div class="wrapper">
	<div class="fxTableFilterHeaderSection">
		<div class="instructions">
		<h2>FX Table Filter: Demo</h2>
		<p>
		Filter through the cells by typing in the input fields at the top of the columns. You can also filter using a dropdown list, checkboxes and a search bar. 
		</p>
		</div>
	</div>
	<div class="content">
		<h3>Additional Filters for Table 1</h3>
		Only Show Yes: <input type="checkbox" id="onlyyes"/>        	
		Only Show No: <input type="checkbox" id="onlyno"/>
        &nbsp;<input type="submit" value="Set Quick Find filter and refresh table" onclick="$('#quickfind').val('12'); $('#demotable1').tableFilterApplyFilter();"/>
		<br/>    	<br/>    
		Quick Find: <input type="text" id="quickfind"/><br/>   
		Quick Find (Text Column 1, Number Column): <input type="text" id="quickfind2"/>

		<a id="cleanfilters" href="#">Clear Filters</a>
		<div class="clear"></div>
		<br/>
		<div class="column1">	
			<h3>Table 1</h3>
			<table id='demotable1'>
				<thead>
								<tr><th>Text Column 1</th><th>Number Column</th><th>Yes/No</th><th>List column</th><th>No Filter</th><th>Date column</th><th>Empty</th></tr></thead>
		</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		
		<div class="column2">	
			<h3>Table 2 <span id='rowcount'></span></h3>
			<table id='demotable2'>
				<thead>
					<tr><th>col1</th></tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>	
		<div class="clear"></div>
		<hr/>
	</div>
</div>
	</body>
</html>
